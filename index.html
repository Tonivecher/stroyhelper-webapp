import { useState } from "react";
import jsPDF from "jspdf";

export default function StroyHelperApp() {
  const [step, setStep] = useState(1);
  const [room, setRoom] = useState("");
  const [length, setLength] = useState("");
  const [width, setWidth] = useState("");
  const [height, setHeight] = useState("");
  const [material, setMaterial] = useState("");
  const [savedRooms, setSavedRooms] = useState([]);

  const area = parseFloat(length) * parseFloat(width);
  const wallArea = 2 * (parseFloat(length) + parseFloat(width)) * parseFloat(height);

  const saveRoom = () => {
    const newRoom = {
      name: room,
      size: `${length}√ó${width}√ó${height}`,
      area: area.toFixed(2),
      wallArea: wallArea.toFixed(2),
      material,
    };
    setSavedRooms([...savedRooms, newRoom]);
  };

  const exportPDF = () => {
    const doc = new jsPDF();
    doc.setFontSize(14);
    doc.text("StroyHelper - –†–∞—Å—á—ë—Ç", 20, 20);
    savedRooms.forEach((room, i) => {
      const offset = 30 + i * 40;
      doc.text(`–ö–æ–º–Ω–∞—Ç–∞: ${room.name}`, 20, offset);
      doc.text(`–†–∞–∑–º–µ—Ä: ${room.size}`, 20, offset + 10);
      doc.text(`–ü–æ–ª: ${room.area} –º¬≤`, 20, offset + 20);
      doc.text(`–°—Ç–µ–Ω—ã: ${room.wallArea} –º¬≤`, 20, offset + 30);
      doc.text(`–ú–∞—Ç–µ—Ä–∏–∞–ª: ${room.material}`, 20, offset + 40);
    });
    doc.save("stroyhelper-—Ä–∞—Å—á—ë—Ç—ã.pdf");
  };

  const goNext = () => setStep(step + 1);
  const goBack = () => setStep(step - 1);

  return (
    <div className="min-h-screen bg-gray-100 p-4 flex flex-col items-center">
      <h1 className="text-2xl font-bold mb-4">StroyHelper</h1>

      {step === 1 && (
        <div className="w-full max-w-md bg-white p-4 rounded-2xl shadow">
          <h2 className="text-lg mb-2">1. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–Ω–∞—Ç—ã</h2>
          <input
            type="text"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã"
            className="input"
            value={room}
            onChange={(e) => setRoom(e.target.value)}
          />
          <input
            type="number"
            placeholder="–î–ª–∏–Ω–∞ (–º)"
            className="input"
            value={length}
            onChange={(e) => setLength(e.target.value)}
          />
          <input
            type="number"
            placeholder="–®–∏—Ä–∏–Ω–∞ (–º)"
            className="input"
            value={width}
            onChange={(e) => setWidth(e.target.value)}
          />
          <input
            type="number"
            placeholder="–í—ã—Å–æ—Ç–∞ (–º)"
            className="input"
            value={height}
            onChange={(e) => setHeight(e.target.value)}
          />
          <button className="btn mt-2" onClick={goNext}>–î–∞–ª–µ–µ</button>
        </div>
      )}

      {step === 2 && (
        <div className="w-full max-w-md bg-white p-4 rounded-2xl shadow">
          <h2 className="text-lg mb-2">2. –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª</h2>
          <select
            className="input"
            value={material}
            onChange={(e) => setMaterial(e.target.value)}
          >
            <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ --</option>
            <option value="–ü–ª–∏—Ç–∫–∞">–ü–ª–∏—Ç–∫–∞</option>
            <option value="–û–±–æ–∏">–û–±–æ–∏</option>
            <option value="–ö—Ä–∞—Å–∫–∞">–ö—Ä–∞—Å–∫–∞</option>
            <option value="–ì–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω">–ì–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω</option>
          </select>
          <div className="flex gap-2 mt-4">
            <button className="btn" onClick={goBack}>–ù–∞–∑–∞–¥</button>
            <button className="btn" onClick={() => {
              saveRoom();
              goNext();
            }}>–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
          </div>
        </div>
      )}

      {step === 3 && (
        <div className="w-full max-w-md bg-white p-4 rounded-2xl shadow">
          <h2 className="text-lg mb-2">3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
          <p>–ö–æ–º–Ω–∞—Ç–∞: <strong>{room}</strong></p>
          <p>–†–∞–∑–º–µ—Ä: {length}–º √ó {width}–º √ó {height}–º</p>
          <p>–ú–∞—Ç–µ—Ä–∏–∞–ª: <strong>{material}</strong></p>
          <p>–ü–ª–æ—â–∞–¥—å –ø–æ–ª–∞: <strong>{area.toFixed(2)} –º¬≤</strong></p>
          <p>–ü–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω: <strong>{wallArea.toFixed(2)} –º¬≤</strong></p>
          <div className="flex flex-col gap-2 mt-4">
            <button className="btn" onClick={() => setStep(1)}>–ù–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</button>
            <button className="btn" onClick={exportPDF}>–°–∫–∞—á–∞—Ç—å PDF</button>
          </div>
        </div>
      )}

      {savedRooms.length > 0 && (
        <div className="w-full max-w-md mt-6 bg-white p-4 rounded-2xl shadow">
          <h2 className="text-lg mb-2">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã</h2>
          {savedRooms.map((r, idx) => (
            <div key={idx} className="border-b py-2 text-sm">
              <p>üè† {r.name} ‚Äî {r.material}</p>
              <p>–ü–æ–ª: {r.area} –º¬≤ | –°—Ç–µ–Ω—ã: {r.wallArea} –º¬≤</p>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// Tailwind helper styles (–≤—Å—Ç–∞–≤–∏—Ç—å –≤ CSS):
// .input { @apply w-full border border-gray-300 rounded-xl px-3 py-2 mb-2; }
// .btn { @apply bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600; }
